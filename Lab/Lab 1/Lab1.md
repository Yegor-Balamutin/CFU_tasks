<p align="center">МИНИСТЕРСТВО НАУКИ  И ВЫСШЕГО ОБРАЗОВАНИЯ РОССИЙСКОЙ ФЕДЕРАЦИИ</p>

<p align="center">Федеральное государственное автономное образовательное учреждение высшего образования</p>

<p align="center">"КРЫМСКИЙ ФЕДЕРАЛЬНЫЙ УНИВЕРСИТЕТ им. В. И. ВЕРНАДСКОГО"</p>

<p align="center">ФИЗИКО-ТЕХНИЧЕСКИЙ ИНСТИТУТ</p>

<p align="center">Кафедра компьютерной инженерии и моделирования</p>

<br>

<h3 align="center">Отчёт по лабораторной работе № 1<br> по дисциплине "Программирование"</h3>

<br><br>

<p>студента 1 курса группы ПИ-б-о-201(1)<br>

Баламутин Егор Никитович<br>

направления подготовки 09.03.04 "Программная инженерия"</p>

<br><br>

<table>

<tr><td>Научный руководитель<br> старший преподаватель кафедры<br> компьютерной инженерии и моделирования</td>

<td>(оценка)</td>

<td>Чабанов В.В.</td>

</tr>

</table>

<br><br>

<p align="center">Симферополь, 2020</p>

<hr>

## Постановка задачи

Разработать сервис предоставляющий данные о погоде в городе Симферополе на момент запроса.
  В качестве источника данных о погоде использовать: http://openweathermap.org/. 
В состав сервиса входит: серверное приложение на языке С++ и клиентское приложение на языке Python.

Серверное приложение (далее Сервер) предназначенное для обслуживания клиентских приложений и
 минимизации количества запросов к сервису openweathermap.org. Сервер должен обеспечивать 
возможность получения данных в формате JSON и виде html виджета (для вставки виджета на страницу будет 
использоваться iframe).

Клиентское приложение должно иметь графический интерфейс отображающий сведения о погоде и 
возможность обновления данных по требованию пользователя.

## Выполнение работы

#### Работа с сервисом openweathermap.org

Вначале я зарегестрировался на сервисе openweathermap.org и в разделе API key получил свой ключ API:`"bad75ef80333e8205e98138e6836321a"`

![API](image/api_key.jpg "Получение ключа API")
<p align="center">Рис 1. Получение ключа API</p>

Затем на странице  http://openweathermap.org/appid#use сервиса я изучил инструкции по работе 
с ключом API и созданию http-запросов. 
После этого я смог составить следующий запрос:

`"http://api.openweathermap.org/data/2.5/onecall?lat=44.9572&lon=34.1108&units=metric&exclude=current,minutely,daily,alerts&lang=ru&appid=bad75ef80333e8205e98138e6836321a"`

где:
* `lat` - широта
* `lon` - долгота
* `lang` - язык
* `units` - система мер
* `exclude` - поля, которые нужно исключить из ответа

При вводе этого запроса сервис генерирует ответ в формате json:

![](image/pic2.png "Ответ сервиса openweather в формате json")
<p align="center">Рис 2. Ответ сервиса openweather в формате json</p>

Я изучил его структуру с помощью сервиса  JSON Viewer.
 Он содержит следующие поля: lat, lon, timezone, timezone_offset и массив hourly
 на 48 эллементов содержащий почасовой прогноз погоды на 48 часов. В элементах этого массива 
и содержится нужная информация. А именно в полях:

* `hourly[i]["dt"]` - значение времени, на которое был сделан прогноз
* `hourly[i]["temp"]` - значение температуры
* `hourly[i]["weather"][0]["description"]` - описание погоды
* `hourly[i]["weather"][0]["icon"]` - номер иконки (для виджета)

#### Работа с сервисом worldtimeapi.org

Также для работы будующего приложения требуется знать текущее время. Для этого нужно воспользоватся 
сервисом worldtimeapi.org, который позваляет получить время в формате json. 
При вводе запроса `"http://worldtimeapi.org/api/timezone/Europe/Simferopol"` сервис генерирует ответ в формате json:

![](image/pic3.png "Ответ сервиса worldtimeapi.org в формате json")
<p align="center">Рис 3. Ответ сервиса worldtimeapi.org в формате json</p>

Нужное значение времени находится в поле `["unixtime"]`. По нему будующая программа будет искать 
подходящий элемент в массиве hourly.

#### Серверное приложение

Серверное приложение написанно на языке C++. Оно принимает запрос, запрашивает данные с сервисов `openweathermap.org` и `worldtimeapi.org` 
и отправляет ответ в виде виджета либо в формате json. Я использовал библиотеку `httplib` для работы с сетью и библиотеку `nlohmann/json` 
для работы с форматом json.

В функции `main()` создаётся сервер. Указывается, что нужно вызвать функцию `gen_response()`, если кто-то обратится к корню сайта, 
а если обратятся на `/raw`, то вызвать функцию `gen_response_raw()`.

![](image/pic4.png "функция main()")
<p align="center">Рис 4. функция main()</p>